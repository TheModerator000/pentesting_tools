#!/bin/bash

# Specify the file containing the list of hosts
hosts_file=$1

# Read the hosts file line by line
while IFS= read -r host || [[ -n "$host" ]]; do
    echo "Connecting to $host..."
    
    # Attempt to connect to the host using telnet
    ( echo "ehlo"; sleep 1; echo "helo"; sleep 1; ) | telnet "$host" > telnet_output.txt &

    # Wait for 5 seconds for the telnet command to complete
    sleep 5

    # Check if the telnet process is still running
    if ps -p $! > /dev/null; then
        # Telnet process is still running, terminate it
        echo "Connection timed out. Moving to the next host."
        kill $!
    else
        # Telnet process completed, check the output
        if grep -q "220" telnet_output.txt; then
            echo "Enumeration successful for $host."
        else
            echo "Enumeration failed for $host."
        fi
       
    fi

    echo
done < "$1"
